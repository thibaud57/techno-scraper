FROM mcr.microsoft.com/playwright/python:v1.51.0-jammy

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=/app

RUN apt-get update \
    && apt-get install -y --no-install-recommends curl \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

# Serveur MCP - Communication via HTTP/SSE (port 8080)
ENV MCP_PORT=8080
EXPOSE 8080

CMD ["python", "-m", "app.mcp"]

# Healthcheck bas√© sur HTTP endpoint
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:${MCP_PORT:-8080}/sse || exit 1
